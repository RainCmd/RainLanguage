name: 构建.so文件

on:
  workflow_dispatch:
    inputs:
      ARM:
        description: 'ARM'
        required: true
        default: false
        type: boolean
      ARM64:
        description: 'ARM64'
        required: true
        default: true
        type: boolean
      x64:
        description: 'x64'
        required: true
        default: false
        type: boolean
      x86:
        description: 'x86'
        required: true
        default: false
        type: boolean
jobs:
  build:
    runs-on: windows-latest

    steps:
    
    - name: 拉取仓库
      uses: actions/checkout@v4
    - name: 安装MSBuild
      uses: microsoft/setup-msbuild@v2
    - name: 安装py依赖
      run: pip install chardet
      
    - name: 构建 RainLanguageSO - arm(android-19)
      if: ${{ success() && inputs.ARM }}
      run: msbuild RainLanguageSO\RainLanguageSO.vcxproj -t:rebuild -verbosity:m -property:Configuration=Release -property:Platform=ARM
    - name: 上传RL.so-arm(android-19)
      if: ${{ success() && inputs.ARM }}
      uses: actions/upload-artifact@v4
      with:
        name: RL.so-arm
        path: RainLanguageSO\ARM\Release\libRainLanguageSO.so
        retention-days: 1
        if-no-files-found: error
        
    - name: 构建 RainLanguageSO - arm64(android-31)
      if: ${{ success() && inputs.ARM64 }}
      run: msbuild RainLanguageSO\RainLanguageSO.vcxproj -t:rebuild -verbosity:m -property:Configuration=Release -property:Platform=ARM64
    - name: 上传RL.so-arm64(android-31)
      if: ${{ success() && inputs.ARM64 }}
      uses: actions/upload-artifact@v4
      with:
        name: RL.so-arm64
        path: RainLanguageSO\ARM64\Release\libRainLanguageSO.so
        retention-days: 1
        if-no-files-found: error
        
    - name: 构建 RainLanguageSO - x64(android-31)
      if: ${{ success() && inputs.x64 }}
      run: msbuild RainLanguageSO\RainLanguageSO.vcxproj -t:rebuild -verbosity:m -property:Configuration=Release -property:Platform=x64
    - name: 上传RL.so-x64(android-31)
      if: ${{ success() && inputs.x64 }}
      uses: actions/upload-artifact@v4
      with:
        name: RL.so-x64
        path: RainLanguageSO\x64\Release\libRainLanguageSO.so
        retention-days: 1
        if-no-files-found: error
        
    - name: 构建 RainLanguageSO - x86(android-19)
      if: ${{ success() && inputs.x86 }}
      run: msbuild RainLanguageSO\RainLanguageSO.vcxproj -t:rebuild -verbosity:m -property:Configuration=Release -property:Platform=x86
    - name: 上传RL.so-x86(android-19)
      if: ${{ success() && inputs.x86 }}
      uses: actions/upload-artifact@v4
      with:
        name: RL.so-x86
        path: RainLanguageSO\x86\Release\libRainLanguageSO.so
        retention-days: 1
        if-no-files-found: error
        


